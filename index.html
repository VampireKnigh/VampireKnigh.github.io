<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>yd&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="yd's blog">
<meta property="og:url" content="http://VampireKnigh.github.io/index.html">
<meta property="og:site_name" content="yd's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yd's blog">
  
    <link rel="alternate" href="/atom.xml" title="yd&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">yd&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://VampireKnigh.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-代码编写规范-排版" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/12/代码编写规范-排版/" class="article-date">
  <time datetime="2018-02-12T07:20:58.000Z" itemprop="datePublished">2018-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/12/代码编写规范-排版/">代码编写规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="排版"><a href="#排版" class="headerlink" title="排版"></a>排版</h2><p>团队需要遵循一致的编写风格规范。</p>
<ol>
<li><p>不同概念之间需要空行</p>
<p>  比如方法与方法，类名与import,import与包名之间等。</p>
<ol>
<li>将逻辑紧密的代码放到一起</li>
</ol>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public void <span class="keyword">addChild(String </span>parentId , String value)&#123;</div><div class="line">	Entity entity = new Entity()<span class="comment">;</span></div><div class="line">	entity.setId(getEneieyId())<span class="comment">;</span></div><div class="line">	entity.setValue(Value)<span class="comment">;</span></div><div class="line"></div><div class="line">	Relation relation =  new Relation()<span class="comment">;</span></div><div class="line">	relation.setParenId(parentId)p<span class="comment">;</span></div><div class="line">	relation.setChildEntityId(entity.getId())<span class="comment">;</span></div><div class="line"></div><div class="line">	saveChild(entity , relation)<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>一行不超过120个字符，换行需要考虑低优先级的运算符，一行中在不同概念(关键字，变量，操作符)之间添加空格，以区分开概念。</li>
</ol>
<p>比如”++”, “.”, “(“前后不需要加空格.</p>
<ol>
<li>采用缩进来区分不同层次概念。<br>由于Tab键在不同操作系统缩进不同，采用4个空格。</li>
</ol>
</li>
</ol>
<p> 建议一：局部变量作用域最小化<br> 建议二：if,for,do,while,else,switch等语句独占一行，而且后面需要添加{}<br> 建议三： 文件长度不要超过500行（可维护性建议）</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p> 注释主要原则是自注释，注释不能包含代码</p>
<ol>
<li><p>应解释代码的意图，而不是描述代码怎么做的<br> 提供有用的，额外的信息，解释背景，提升代码可读性</p>
</li>
<li><p>代码与注释要一致，避免产生误导。<br> 说明： 误导的产生并不是有意为之，而是在代码修改的同时没有修改代码注释产生的。若注释没用则删除。</p>
</li>
<li><p>注释与代码位置相邻，放在注释代码的上方或右方<br>  说明：大多数放在上方，变量、枚举的注释可选择在右方。（并不推荐）</p>
<p>建议一： 不要用注释保留废弃代码。（可使用git等恢复任意时刻的代码）<br>建议二： 不要用注释记录修改日志</p>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><p>原则：便于代码的理解,具有下列特征：</p>
<ol>
<li><p>能清晰的表达意图，使用完整的单词</p>
</li>
<li><p>避免造成误导<br>如：避免使用String accountList; accountList并不是List变量</p>
</li>
<li><p>避免不必要的编解码</p>
</li>
<li><p>能区分出意思<br>不建议使用product,productinfo,productdata这种不能区分出意思的</p>
</li>
<li><p>不用或者少用缩写<br>少于15个字母的一般不用缩写。</p>
</li>
</ol>
<p>规则1：禁止魔鬼数字。<br> 说明：直接使用数字，造成代码难以理解，采用有意思的静态变量或枚举来代替。</p>
 <figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> final <span class="keyword">int</span> <span class="built_in">CLOSED</span> = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> doorState = <span class="built_in">CLOSED</span>;</div></pre></td></tr></table></figure>
<p> 或者是</p>
 <figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">eum <span class="keyword">Signal</span> &#123;</div><div class="line">	YELLOW , RED </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> <span class="keyword">doorColor</span> = Signal.RED;</div></pre></td></tr></table></figure>
<p>规则2： 常量命名，由大写字母组成，单词间使用下划线分割，且使用static final 修饰</p>
<p>规则3： 变量，属性命名，使用名词，并采用首字母小写的驼峰命名法。</p>
<p>规则4： 方法的命名，使用动词和动宾结构，采用首字母小写的驼峰命名法。<br> 说明： 格式如：</p>
<pre><code>get + 属性名()
is  + 布尔属性名()
set + 属性名()
has + 名词/形容词()
</code></pre><p>规则5： 类和接口的命名，采用首字母大写的驼峰命名法<br>说明： 类的命名，不应用动词，采用名词。</p>
<p>规则6： 包的命名，所有字母均为小写<br> 说明： 包名采用域后缀倒置的加上自定义的包名，再加上产品名称和模块名称。</p>
</li>
</ol>
<p> 建议一： 数组声明的时候使用int[] index,;而不是使用int index[];</p>
<h2 id="变量和类型"><a href="#变量和类型" class="headerlink" title="变量和类型"></a>变量和类型</h2><pre><code>原则： 谨慎使用静态成员变量
    说明：在以下场景需要合理使用静态变量：
        1.类的所有实例必须共享一个变量时，比如，为实现某个人物，该类的所有实例共用的变量，如计算器等。
        2.工具类提供的常量，如配置文件中的参数映射到类的变量时，基本上第一次赋值后，数据不在被修改。
        3.单例模式中应用。
        <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ElvisINSTANCE = <span class="keyword">new</span> Elvis();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> beltSize;</div><div class="line">	privte <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CURRENT_YEAR = Calendar.getInstance().get(Calendat.YEAR);</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span></span>&#123;</div><div class="line">		beltSize = CURRENT_YEAR ;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

        上例导致beltSize在CURRENT_YEAR为0时赋值导致错误。
</code></pre><p> 规则1： 避免随意进行类型强制转换，应改善设计，或在转换前用instanceof 进行判断<br> 说明： 特别是在集合List类型中容易出现错误。后面JDK1.3,1.4添加泛型改善了设计<br>         <figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">List datas = <span class="keyword">new</span> ArrayList();</div><div class="line">datas.<span class="built_in">add</span>(<span class="string">"Mike"</span>);</div><div class="line">datas.<span class="built_in">add</span>(<span class="string">"Jerry"</span>);</div><div class="line">datas.<span class="built_in">add</span>(<span class="number">1</span>);</div><div class="line">datas.<span class="built_in">add</span>(<span class="number">2</span>);</div><div class="line">===&gt;</div><div class="line">List&lt;<span class="keyword">String</span>&gt; names = <span class="keyword">new</span> List&lt;<span class="keyword">String</span>&gt;(INIT_SIZE);</div><div class="line">names.<span class="built_in">add</span>(<span class="string">"Mike"</span>);</div><div class="line">names.<span class="built_in">add</span>(<span class="string">"Jerry"</span>);</div><div class="line"></div><div class="line">List&lt;Integer&gt; prices = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(INIT_SIZE);</div><div class="line">prices.<span class="built_in">add</span>(<span class="number">1</span>);</div><div class="line">prices.<span class="built_in">add</span>(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<p>规则2： 需要精确计算时不要使用float和double<br>    说明：浮点数在计算精度时会出错，应使用int,long,BigDecimal来计算<br>    <figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">int prices = <span class="number">1.03</span> - <span class="number">0.42</span><span class="comment">;</span></div><div class="line">==&gt;</div><div class="line">BigDecimal income = new BigDecimal(<span class="string">"1.03"</span>)<span class="comment">;</span></div><div class="line">BigDecimal expense = new BigDecimal(<span class="string">"0.42"</span>)<span class="comment">;</span></div><div class="line">System.out.println(income - expense)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>规则3： 不能用浮点数来做循环变量</p>
<p>规则4：浮点型数据判断相等不能用 ==<br>    说明： 应使用以下来判断：<br>    <figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">float</span> a = .;</div><div class="line"><span class="keyword">float</span> b = .;</div><div class="line"><span class="keyword">if</span>(Math.<span class="built_in">abs</span>(a-b)&lt;<span class="number">1E-6</span>f)&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>规则5： 避免一个局部变量在前后表达不同含义<br>    <figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String name <span class="comment">;</span></div><div class="line"><span class="attribute">name</span> = Person.getFirstName()<span class="comment">;</span></div><div class="line">...</div><div class="line"><span class="attribute">name</span> = Person.getLastName()<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>规则6： 不要在单个表达式对相同变量赋值超过一次</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><pre><code>原则1： 短小，方法长度不超过50行
原则2;     遵循单一职责原则
原则3： 遵循单一抽象层次原则
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</div><div class="line">	input();</div><div class="line">	<span class="keyword">int</span> tags = <span class="number">1</span>; ===&gt; process();</div><div class="line">	output():</div><div class="line">&#125;</div></pre></td></tr></table></figure>

原则4： 遵循命令和查询职责分离原则

规则1:  不要把方法的入参当做工作变量、临时变量

规则2： 使用类名调用静态方法，不要用实例来调用

建议1： 应明确规定对接口方法参数的合法性检查有调用者负责还是由接口方法本身负责
说明： 对预计不太可能发生的使用断言检查，对预计可能发生的采用错误处理检查

建议2： 方法参数个数不宜过多

建议3： 谨慎使用可变数量参数的方法
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2018/02/12/代码编写规范-排版/" data-id="cjdk0qrme000bq8o0zw80idy2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA-代码编写规范/">JAVA 代码编写规范</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java基础（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/12/Java基础（一）/" class="article-date">
  <time datetime="2018-02-12T06:46:35.000Z" itemprop="datePublished">2018-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/12/Java基础（一）/">Java基础（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>学习《JAVA疯狂讲义》</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2018/02/12/Java基础（一）/" data-id="cjdk0qrir0000q8o0uzahp2nd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java基础/">Java基础</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-图片优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/15/图片优化/" class="article-date">
  <time datetime="2017-06-15T06:37:52.000Z" itemprop="datePublished">2017-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/15/图片优化/">图片优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>对于图片的性能优化有几种，base-64编码(Data-URL)，使用SVG，使用CSS sprites，图片预加载</p>
<h1 id="base-64编码"><a href="#base-64编码" class="headerlink" title="base-64编码"></a>base-64编码</h1><h2 id="base-64理解"><a href="#base-64理解" class="headerlink" title="base-64理解"></a>base-64理解</h2><p>Base64是网络上最常见的用于传输8Bit字节代码的编码方式之一，可用于在HTTP环境下传递较长的标识信息。</p>
<h2 id="base-64优缺点及使用"><a href="#base-64优缺点及使用" class="headerlink" title="base-64优缺点及使用"></a>base-64优缺点及使用</h2><p>优点：</p>
<ol>
<li>减少了HTTP请求</li>
<li>某些文件可以避免跨域的问题</li>
<li>没有图片更新要重新上传，还要清理缓存的问题</li>
</ol>
<p>缺点：</p>
<ol>
<li>增加了CSS文件的尺寸</li>
<li>编码成本</li>
</ol>
<p>适用于：</p>
<p>这类图片不能与其他图片以CSS Sprite的形式存在，只能独行<br>这类图片从诞生之日起，基本上很少被更新<br>这类图片的实际尺寸很小<br>这类图片在网站中大规模使用<br>比如loading的gif,背景虚线</p>
<p>CSS文件的优点就是重用，因此，如果背景图片就一个地方使用，减少的请求数有限，考虑到其他成本，还不如直接使用普通url图片地址</p>
<h2 id="base-64编码使用"><a href="#base-64编码使用" class="headerlink" title="base-64编码使用"></a>base-64编码使用</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">background</span>-<span class="built_in">image</span>:url(data:<span class="built_in">image</span>/gif;<span class="built_in">base64</span>,R0lGODlhBAABAIABAMLBwfLx8SH5BAEAAAEALAAAAAAEAAEAAAICRF4AOw==);</div><div class="line"><span class="keyword">or</span></div><div class="line">&lt;img src=<span class="string">"data:image/gif;base64,R0lGODlhAwADAIABAL6+vv///yH5BAEAAAEALAAAAAADAAMAAAIDjA9WADs="</span> /&gt;</div></pre></td></tr></table></figure>
<p>对文件base-64编码:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">font-face</span>&#123;</div><div class="line">    <span class="attribute">font-family</span>: forTest;</div><div class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAh4 ... RFERuENEGADl7JlY=) <span class="built_in">format</span>(<span class="string">'woff'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="css-sprites"><a href="#css-sprites" class="headerlink" title="css sprites"></a>css sprites</h1><p><a href="http://www.cnblogs.com/qianlitiaotiao/p/5054231.html" target="_blank" rel="external">http://www.cnblogs.com/qianlitiaotiao/p/5054231.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/06/15/图片优化/" data-id="cjdk0qros000wq8o0oozb6ghu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/性能优化/">性能优化</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-gulp和webpack的区别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/25/gulp和webpack的区别/" class="article-date">
  <time datetime="2017-05-25T07:27:13.000Z" itemprop="datePublished">2017-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/25/gulp和webpack的区别/">gulp和webpack的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前端开发和其他开发工作的主要区别，首先是前端是基于多语言、多层次的编码和组织工作，其次前端产品的交付是基于浏览器，这些资源是通过增量加载的方式运行到浏览器端，如何在开发环境组织好这些碎片化的代码和资源，并且保证他们在浏览器端快速、优雅的加载和更新，就需要一个模块化系统，这个理想中的模块化系统是前端工程师多年来一直探索的难题。</p>
<h2 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h2><p>Gulp就是为了规范前端开发流程，实现前后端分离、模块化开发、版本控制、文件合并与压缩、mock数据等功能的一个<strong>前端自动化构建工具</strong>。说的形象点，“Gulp就像是一个产品的流水线，整个产品从无到有，都要受流水线的控制，在流水线上我们可以对产品进行管理。”</p>
<p>另外，Gulp是通过task对整个开发过程进行构建。</p>
<h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2><p>Webpack 是当下最热门的<strong>前端资源模块化管理和打包工具</strong>。它可以将许多松散的模块按照依赖和规则打包成符合生产环境部署的前端资源。还可以将按需加载的模块进行代码分隔，等到实际需要的时候再异步加载。通过 loader的转换，任何形式的资源都可以视作模块，比如 CommonJs 模块、AMD 模块、ES6 模块、CSS、图片、JSON、Coffeescript、LESS 等。</p>
<h2 id="Gulp和Webpack功能实现对比"><a href="#Gulp和Webpack功能实现对比" class="headerlink" title="Gulp和Webpack功能实现对比"></a>Gulp和Webpack功能实现对比</h2><p>简单介绍了一下Gulp和Webpack的概念性的问题和大环境，接下来进入本文的主题，对比一下Gulp和Webpack的优缺点。将从基本概念、模块化开发、文件合并与压缩、启动本地Server、mock数据、版本控制几个方面对Gulp和Webpack进行对比。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>首先从概念上，我们可以清楚的看出，Gulp和Webpack的侧重点是不同的。</p>
<p>Gulp侧重于前端开发的整个过程的控制管理（像是流水线），我们可以通过给gulp配置不通的task（通过Gulp中的gulp.task()方法配置，比如启动server、sass/less预编译、文件的合并压缩等等）来让gulp实现不同的功能，从而构建整个前端开发流程。</p>
<p>Webpack有人也称之为模块打包机，由此也可以看出Webpack更侧重于模块打包，当然我们可以把开发中的所有资源（图片、js文件、css文件等）都可以看成模块，最初Webpack本身就是为前端JS代码打包而设计的，后来被扩展到其他资源的打包处理。Webpack是通过loader（加载器）和plugins（插件）对资源进行处理的。</p>
<p>另外我们知道Gulp是对整个过程进行控制，所以在其配置文件（gulpfile.js）中配置的每一个task对项目中该task配置路径下所有的资源都可以管理。<br>Webpack则不是这样管理资源的，它是根据模块的依赖关系进行静态分析，然后将这些模块按照指定的规则生成对应的静态资源</p>
<h3 id="模块化开发"><a href="#模块化开发" class="headerlink" title="模块化开发"></a>模块化开发</h3><p>所谓的前端模块化开发是指，在开发的时候，把不通的资源文件按照他的具体用途进行分类管理，在使用的时候利用CommonJS、AMD、CMD等规范将这些资源文件引入到当前文件中。然后在测试或者最后上线的时候，将这些资源文件按照一定的要求进行压缩合并再加上版本控制处理。即<strong>对内容的管理，是为了解耦合。</strong></p>
<p>在实际开发过程中，在src目录下工作，html、js和css等文件通过gulp的task配置，执行合并和压缩后输出到build目录下。在详细一点就是：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">1. </span>创建主页html文件</div><div class="line"><span class="bullet">2. </span>创建与之对应的app.js入口文件和app.scss入口文件。这两个文件只通过CommonJS规范引入各自views文件中自定义的js(或scss)文件，具体逻辑不写此文件中。</div><div class="line"><span class="bullet">3. </span>在views目录下编写js（或css）文件的逻辑代码，其中如果多个文件需要公共逻辑或者工具方法，就可以抽离出来在util文件夹下创建对应的公共方法，然后在views中需要的js（或css）文件中通过CommonJS规范引入使用。libs目录下的第三方库或框架也是这个思想去引用。</div><div class="line"><span class="bullet">4. </span>scripts目录下的tpls文件是用来放置html模板的，引用方式和引用libs相同。</div></pre></td></tr></table></figure></p>
<p>webpack的模块化实现和Gulp的基本相同，只不过实现过程中使用到的插件或者说模块不同，配置不同而已。对于解决webpack文件之间的依赖关系，可以使用extract-text-webpack-plugin的模块将css文件从js文件中剥离出来。</p>
<h3 id="文件合并与压缩"><a href="#文件合并与压缩" class="headerlink" title="文件合并与压缩"></a>文件合并与压缩</h3><p>上面的模块化中，模块化其实很大一部分是在做文件的合并与压缩操作。<br>Webpack应该比Gulp更擅长文件合并和压缩，毕竟人家被称为模块打包机。</p>
<p>Gulp可以对css文件以及js文件进行合并压缩处理，而Webpack可以实现对css文件，js文件，html文件等进行合并压缩和图片的压缩，还可以对js文件进行编译（如es6–&gt;es5，react jsx）等等，这些都是通过Webpack的loader实现的，当然这些也可以加入到Gulp中，毕竟Gulp把Webpack当做一个模块，通过gulp-webpack都引入了。</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">gulp</th>
<th style="text-align:center">webpack</th>
</tr>
</thead>
<tbody>
<tr>
<td>css的压缩</td>
<td style="text-align:center">gulp-minify-css</td>
<td style="text-align:center">uglifyJS(style-loader!css-loader 读取和插入)</td>
</tr>
<tr>
<td>js合并压缩</td>
<td style="text-align:center">gulp-uglify和gulp-concat</td>
<td style="text-align:center">uglifyJS</td>
</tr>
<tr>
<td>html合并压缩</td>
<td style="text-align:center"></td>
<td style="text-align:center">HtmlWebpackPlugin（创建index.html）html-minifier</td>
</tr>
<tr>
<td>sass/less预编译</td>
<td style="text-align:center">gulp-sass 和gulp-less</td>
<td style="text-align:center">scss-loader、less-loader</td>
</tr>
<tr>
<td>图片的压缩</td>
<td style="text-align:center">gulp-imagemin和imagemin-pngquant</td>
<td style="text-align:center">url-loader?limit=8192</td>
</tr>
</tbody>
</table>
<h3 id="启动server"><a href="#启动server" class="headerlink" title="启动server"></a>启动server</h3><p>gulp启动server: gulp-server模块</p>
<p>livereload:true属性只是监控到我们修改文件后刷新浏览器重新请求文件</p>
<p>webpack启动server: webpack-dev-server模块<br>一是为静态文件提供server服务，二是自动刷新和热替换(HMR)<br><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">webpack</span><span class="literal">-</span><span class="comment">dev</span><span class="literal">-</span><span class="comment">server</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">inline</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">hot</span></div></pre></td></tr></table></figure></p>
<h3 id="mock数据"><a href="#mock数据" class="headerlink" title="mock数据"></a>mock数据</h3><p>Gulp中对mock数据的实现使通过NodeJS内置的fs模块和url模块实现的。<br>具体来说，就是通过NodeJS拦截http请求，根据请求URL来模拟后端做出处理后返回不同的数据。<br>webpack通过json-server来实现，它的实现原理就是，启动一个本地3000端口作为mock数据的端口，然后我们在Webpack中配置一个代理，让所有请求代理到3000端口上去，就可以获取到数据了。</p>
<h3 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h3><p>gulp通过gulp-rev和gulp-rev-collector模块，前者用于生成文件的MD5码文件和按MD5码命名的资源文件，后者是利用MD5码，对文件名进行替换。<br>Webpack中需要版本控制的有css、js文件，不过Webpack的版本控制只实现了将css、js文件添加hash值方式命名的文件方式，修改引用路径中的文件名需手动实现。<br>不过实现确实很简单，只需要将webpack.config.js配置文件中的output.filename和plugins中的输出文件名称修改一下即可。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Gulp侧重整个过程的控制，Webpack在模块打包方面有特别出众。所以，Gulp + Webpack 组合使用更方便。</p>
<p>参考自：<br><a href="http://chping.website/2016/10/18/gulp%E5%92%8Cwebpack%E5%AF%B9%E6%AF%94/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">两者对比</a><br><a href="https://github.com/ruanyf/webpack-demos#demo05-image-loader-source" target="_blank" rel="external">webpack</a><br><a href="https://github.com/zhonglimh/Gulp/tree/master/Example1" target="_blank" rel="external">gulp</a><br>未阅读：<br><a href="https://github.com/chemdemo/webpack-seed" target="_blank" rel="external">gulp+webpack1</a><br><a href="https://zhuanlan.zhihu.com/p/21312474" target="_blank" rel="external">gulp+webpack2</a><br><a href="http://www.cnblogs.com/maskmtj/archive/2016/07/21/5597307.html" target="_blank" rel="external">gulp+webpack3</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/05/25/gulp和webpack的区别/" data-id="cjdk0qrll0003q8o0wfkm738n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端构建工具/">前端构建工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-DOM-diff算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/21/react-DOM-diff算法/" class="article-date">
  <time datetime="2017-05-21T03:10:01.000Z" itemprop="datePublished">2017-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/21/react-DOM-diff算法/">react DOM diff算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="DOM-diff算法认识"><a href="#DOM-diff算法认识" class="headerlink" title="DOM diff算法认识"></a>DOM diff算法认识</h2><p>首先认识到React组件并不是真实的 DOM 节点，而是存在于内存之中的一种数据结构，叫做虚拟 DOM （virtual DOM）。只有当它插入文档以后，才会变成真实的 DOM 。<br>React 中最值得称道的部分莫过于 Virtual DOM 与 diff 的完美结合，特别是其高效的 diff 算法，让用户可以无需顾忌性能问题而”任性自由”的刷新页面，让开发者也可以无需关心 Virtual DOM 背后的运作原理，因为 React diff 会帮助我们计算出 Virtual DOM 中真正变化的部分，并只针对该部分进行实际 DOM 操作，而非重新渲染整个页面，从而保证了每次操作更新后页面的高效渲染，因此 Virtual DOM 与 diff 是保证 React 性能口碑的幕后推手。<br>在React中，构建UI界面的思路是由当前状态决定界面。前后两个状态就对应两套界面，然后由React来比较两个界面的区别，这就需要对DOM树进行Diff算法分析。</p>
<p>即给定任意两棵树，找到最少的转换步骤。</p>
<h2 id="传统-diff-算法"><a href="#传统-diff-算法" class="headerlink" title="传统 diff 算法"></a>传统 diff 算法</h2><p>传统 diff 算法通过循环递归对节点进行依次对比，效率低下，算法复杂度达到 O(n3)。现今的 CPU 每秒钟能执行大约30亿条指令，即便是最高效的实现，也不可能在一秒内计算出差异情况。<br>传统的diff算法通过递归实现:<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> result = [];</div><div class="line"><span class="comment">// 比较叶子节点</span></div><div class="line"><span class="keyword">const</span> diffLeafs = <span class="function"><span class="keyword">function</span>(<span class="params">beforeLeaf, afterLeaf</span>) </span>&#123;</div><div class="line">  <span class="comment">// 获取较大节点树的长度</span></div><div class="line">  <span class="keyword">let</span> count = <span class="built_in">Math</span>.max(beforeLeaf.children.length, afterLeaf.children.length);</div><div class="line">  <span class="comment">// 循环遍历</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">    <span class="keyword">const</span> beforeTag = beforeLeaf.children[i];</div><div class="line">    <span class="keyword">const</span> afterTag = afterLeaf.children[i];</div><div class="line">    <span class="comment">// 添加 afterTag 节点</span></div><div class="line">    <span class="keyword">if</span> (beforeTag === <span class="literal">undefined</span>) &#123;</div><div class="line">      result.push(&#123;<span class="keyword">type</span>: <span class="string">"add"</span>, element: afterTag&#125;);</div><div class="line">    <span class="comment">// 删除 beforeTag 节点</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (afterTag === <span class="literal">undefined</span>) &#123;</div><div class="line">      result.push(&#123;<span class="keyword">type</span>: <span class="string">"remove"</span>, element: beforeTag&#125;);</div><div class="line">    <span class="comment">// 节点名改变时，删除 beforeTag 节点，添加 afterTag 节点</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (beforeTag.tagName !== afterTag.tagName) &#123;</div><div class="line">      result.push(&#123;<span class="keyword">type</span>: <span class="string">"remove"</span>, element: beforeTag&#125;);</div><div class="line">      result.push(&#123;<span class="keyword">type</span>: <span class="string">"add"</span>, element: afterTag&#125;);</div><div class="line">    <span class="comment">// 节点不变而内容改变时，改变节点</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (beforeTag.innerHTML !== afterTag.innerHTML) &#123;</div><div class="line">      <span class="keyword">if</span> (beforeTag.children.length === <span class="number">0</span>) &#123;</div><div class="line">        result.push(&#123;</div><div class="line">          <span class="keyword">type</span>: <span class="string">"changed"</span>,</div><div class="line">          beforeElement: beforeTag,</div><div class="line">          afterElement: afterTag,</div><div class="line">          html: afterTag.innerHTML</div><div class="line">      &#125;);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 递归比较</span></div><div class="line">        diffLeafs(beforeTag, afterTag);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="React-diff"><a href="#React-diff" class="headerlink" title="React diff"></a>React diff</h2><p>React 通过制定大胆的策略，将 O(n3) 复杂度的问题转换成 O(n) 复杂度的问题。那么肯定会有一些地方有牺牲。</p>
<h3 id="diff-策略"><a href="#diff-策略" class="headerlink" title="diff 策略"></a>diff 策略</h3><ol>
<li>Web UI 中 DOM 节点跨层级的移动操作特别少，可以忽略不计。</li>
<li>拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构。</li>
<li>对于同一层级的一组子节点，它们可以通过唯一 id 进行区分。<br>基于以上三个前提策略，React 分别对 tree diff、component diff 以及 element diff 进行算法优化，事实也证明这三个前提策略是合理且准确的，它保证了整体界面构建的性能。<br><img src="https://sfault-image.b0.upaiyun.com/277/884/2778846299-5707849bd3992" alt="react diff"></li>
</ol>
<h4 id="tree-diff"><a href="#tree-diff" class="headerlink" title="tree diff"></a>tree diff</h4><p>React 对树的算法进行了简洁明了的优化，即对树进行分层比较，两棵树只会对同一层次的节点进行比较。<br><img src="http://cdn3.infoqstatic.com/statics_s2_20170516-0317u5/resource/articles/react-dom-diff/zh/resources/0909000.png" alt=""><br>React只会对相同颜色方框内的DOM节点进行比较，即同一个父节点下的所有子节点。当发现节点已经不存在，则该节点及其子节点会被完全删除掉，不会用于进一步的比较。这样只需要对树进行一次遍历，便能完成整个DOM树的比较。<br>若有跨层的树：<br><img src="http://cdn3.infoqstatic.com/statics_s2_20170516-0317u5/resource/articles/react-dom-diff/zh/resources/0909001.png" alt=""><br>A节点被整个移动到D节点下，直观的考虑DOM Diff操作应该是<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">A</span><span class="selector-class">.parent</span><span class="selector-class">.remove</span>(<span class="selector-tag">A</span>); </div><div class="line"><span class="selector-tag">D</span><span class="selector-class">.append</span>(<span class="selector-tag">A</span>);</div></pre></td></tr></table></figure></p>
<p>但因为React只会简单的考虑同层节点的位置变换，对于不同层的节点，只有简单的创建和删除。当根节点发现子节点中A不见了，就会直接销毁A；而当D发现自己多了一个子节点A，则会创建一个新的A作为子节点。因此对于这种结构的转变的实际操作是：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A.destroy()<span class="comment">;</span></div><div class="line"><span class="attribute">A</span> = new A()<span class="comment">;</span></div><div class="line">A.append(new B())<span class="comment">;</span></div><div class="line">A.append(new C())<span class="comment">;</span></div><div class="line">D.append(A)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>由此可发现，当出现节点跨层级移动时，并不会出现想象中的移动操作，而是以 A 为根节点的树被整个重新创建，这是一种影响 React 性能的操作，因此<strong>React 官方建议不要进行 DOM 节点跨层级的操作。</strong></p>
<h4 id="component-diff"><a href="#component-diff" class="headerlink" title="component diff"></a>component diff</h4><p>如下图，当 component D 改变为 component G 时，即使这两个 component 结构相似，一旦 React 判断 D 和 G 是不同类型的组件，就不会比较二者的结构，而是直接删除 component D，重新创建 component G 以及其子节点。虽然当两个 component 是不同类型但结构相似时，React diff 会影响性能，但正如 React 官方博客所言：不同类型的 component 是很少存在相似 DOM tree 的机会，因此这种极端因素很难在实现开发过程中造成重大影响的。<br><img src="http://ww3.sinaimg.cn/mw690/61ff3868gw1ey1zjqh0shj20f2065js4.jpg" alt=""></p>
<h4 id="element-diff"><a href="#element-diff" class="headerlink" title="element diff"></a>element diff</h4><p>当节点处于同一层级时，React diff 提供了三种节点操作，分别为：INSERT_MARKUP（插入）、MOVE_EXISTING（移动）和 REMOVE_NODE（删除）。</p>
<ol>
<li><p>INSERT_MARKUP，新的 component 类型不在老集合里， 即是全新的节点，需要对新节点执行插入操作。</p>
</li>
<li><p>MOVE_EXISTING，在老集合有新 component 类型，且 element 是可更新的类型，generateComponentChildren 已调用 receiveComponent，这种情况下 prevChild=nextChild，就需要做移动操作，可以复用以前的 DOM 节点。</p>
</li>
<li><p>REMOVE_NODE，老 component 类型，在新集合里也有，但对应的 element 不同则不能直接复用和更新，需要执行删除操作，或者老 component 不在新集合里的，也需要执行删除操作。<br>如下图，老集合中包含节点：A、B、C、D，更新后的新集合中包含节点：B、A、D、C，此时新老集合进行 diff 差异化对比，发现 B != A，则创建并插入 B 至新集合，删除老集合 A；以此类推，创建并插入 A、D 和 C，删除 B、C 和 D。<br><img src="http://ww2.sinaimg.cn/mw690/61ff3868gw1ey22lddptuj20e507f74r.jpg" alt=""><br>针对这一现象，React 提出优化策略：允许开发者对同一层级的同组子节点，添加唯一 key 进行区分，虽然只是小小的改动，性能上却发生了翻天覆地的变化！<br>此时 React 给出的 diff 结果为：B、D 不做任何操作，A、C 进行移动操作<br><img src="http://ww1.sinaimg.cn/mw690/61ff3868gw1ey23a4zm67j20ef08igm9.jpg" alt=""><br>针对key有个小的问题<br><img src="http://cdn3.infoqstatic.com/statics_s2_20170516-0317u5/resource/articles/react-dom-diff/zh/resources/0909003.png" alt=""><br>这是React在遇到列表时却又找不到key时提示的警告。虽然无视这条警告大部分界面也会正确工作，但这通常意味着潜在的性能问题。因为React觉得自己可能无法高效的去更新这个列表。<br>对于下图：<br><img src="http://cdn3.infoqstatic.com/statics_s2_20170516-0317u5/resource/articles/react-dom-diff/zh/resources/0909007.png" alt=""><br>即将同一层的节点位置进行调整。如果未提供key，那么React认为B和C之后的对应位置组件类型不同，因此完全删除后重建，控制台输出如下：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">B will unmount.</div><div class="line">C will unmount.</div><div class="line">C is created.</div><div class="line">B is created.</div><div class="line">C did mount.</div><div class="line">B did mount.</div><div class="line">A is updated.</div><div class="line">R is updated.</div></pre></td></tr></table></figure>
</li>
</ol>
<p>而如果提供了key，如下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">shape5: function() &#123;</div><div class="line">  return (</div><div class="line">    <span class="tag">&lt;<span class="name">Root</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">A</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">B</span> <span class="attr">key</span>=<span class="string">"B"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">C</span> <span class="attr">key</span>=<span class="string">"C"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">A</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;,</div><div class="line"></div><div class="line">shape6: function() &#123;</div><div class="line">  return (</div><div class="line">    <span class="tag">&lt;<span class="name">Root</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">A</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">C</span> <span class="attr">key</span>=<span class="string">"C"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">B</span> <span class="attr">key</span>=<span class="string">"B"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">A</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>那么控制台输出如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">C <span class="keyword">is</span> updated.</div><div class="line">B <span class="keyword">is</span> updated.</div><div class="line">A <span class="keyword">is</span> updated.</div><div class="line">R <span class="keyword">is</span> updated.</div></pre></td></tr></table></figure></p>
<p>可以看到，对于列表节点提供唯一的key属性可以帮助React定位到正确的节点进行比较，从而大幅减少DOM操作次数，提高了性能。<br>React组件更新生命周期状态迁移：<br><img src="http://upload-images.jianshu.io/upload_images/1814354-4bf62e54553a32b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="由DOM-Diff算法理解组件的生命周期"><a href="#由DOM-Diff算法理解组件的生命周期" class="headerlink" title="由DOM Diff算法理解组件的生命周期"></a>由DOM Diff算法理解组件的生命周期</h2><p><a href="https://vampireknigh.github.io/react/dom-diff/index.html">示例</a><br>观察控制台查看生命状态</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/05/21/react-DOM-diff算法/" data-id="cjdk0qrlq0004q8o0gcur3jpg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-前端/">react 前端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-基于文件上传进度条实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/13/基于文件上传进度条实现/" class="article-date">
  <time datetime="2017-05-13T01:53:06.000Z" itemprop="datePublished">2017-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/13/基于文件上传进度条实现/">基于文件上传进度条实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>拖放文件到浏览器以及基于文件上传进度条的实现现在想到的有两种方法，一种方法是利用HTML5种的File API和ajax progress事件上传文件，另一种方法是利用JQuery file upload 插件来实现。</p>
<h2 id="HTML5实现"><a href="#HTML5实现" class="headerlink" title="HTML5实现"></a>HTML5实现</h2><p>主要使用的方法有：<br>file.name,    file.size,    file.type:文件的MIME类型,    （lastModifiedDate:上次修改时间只有chrome实现），</p>
<p>dragenter,    dragove,drop事件，    event.dataTransfer.files读取到放置的文件，</p>
<p>xhr的progress事件，    event.lengthComputable:进度信息可否使用的bool值，  evnet.position:已经接收的字节数,event.totalSize:根据Content-Length相应头部确定的预期字节数</p>
<p>对于xhr的progress事件分为上传和下载两种情况<br>1.下载的progress事件属于XMLHttpRequest对象<br>2.上传的progress事件属于XMLHttpProgress.upload对象</p>
<p>实例代码：<br><figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="meta">&lt;!doctype html&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></div><div class="line">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;&lt;<span class="attr">title</span>&gt;</span>Upload Files using XMLHttpRequest - Minimal<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">        <span class="selector-class">.dragFile</span>&#123;</div><div class="line">            <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">            <span class="attribute">height</span>:<span class="number">200px</span>;</div><div class="line">            <span class="attribute">box-sizing</span>: border-box;</div><div class="line">            <span class="attribute">padding</span>:<span class="number">20px</span>;</div><div class="line">            <span class="attribute">border</span>:<span class="number">1px</span> solid;</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form1"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"Upload.aspx"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"fileToUpload"</span>&gt;</span>Select a File to Upload<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"fileToUpload"</span> <span class="attr">id</span>=<span class="string">"fileToUpload"</span> <span class="attr">onchange</span>=<span class="string">"fileSelected();"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"fileName"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"fileSize"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"fileType"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"uploadFile()"</span> <span class="attr">value</span>=<span class="string">"Upload"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"progressNumber"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dragFile"</span> <span class="attr">id</span>=<span class="string">"droptarget"</span>&gt;</span>拖放文件到这里<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"output"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fileSelected</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'fileToUpload'</span>).files[<span class="number">0</span>];</div><div class="line">        <span class="keyword">if</span> (file) &#123;</div><div class="line">            <span class="keyword">var</span> fileSize = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (file.size &gt; <span class="number">1024</span> * <span class="number">1024</span>)</div><div class="line">                fileSize = (<span class="built_in">Math</span>.round(file.size * <span class="number">100</span> / (<span class="number">1024</span> * <span class="number">1024</span>)) / <span class="number">100</span>).toString() + <span class="string">'MB'</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                fileSize = (<span class="built_in">Math</span>.round(file.size * <span class="number">100</span> / <span class="number">1024</span>) / <span class="number">100</span>).toString() + <span class="string">'KB'</span>;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'fileName'</span>).innerHTML = <span class="string">'Name: '</span> + file.name;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'fileSize'</span>).innerHTML = <span class="string">'Size: '</span> + fileSize;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'fileType'</span>).innerHTML = <span class="string">'Type: '</span> + file.type;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</div><div class="line">        fd.append(<span class="string">"fileToUpload"</span>, <span class="built_in">document</span>.getElementById(<span class="string">'fileToUpload'</span>).files[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        xhr.upload.addEventListener(<span class="string">"progress"</span>, uploadProgress, <span class="literal">false</span>);</div><div class="line">        xhr.addEventListener(<span class="string">"load"</span>, uploadComplete, <span class="literal">false</span>);</div><div class="line">        xhr.addEventListener(<span class="string">"error"</span>, uploadFailed, <span class="literal">false</span>);</div><div class="line">        xhr.addEventListener(<span class="string">"abort"</span>, uploadCanceled, <span class="literal">false</span>);</div><div class="line">        xhr.open(<span class="string">"POST"</span>, <span class="string">"upload.do"</span>);<span class="comment">//修改成自己的接口</span></div><div class="line">        xhr.send(fd);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">uploadProgress</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (evt.lengthComputable) &#123;</div><div class="line">            <span class="keyword">var</span> percentComplete = <span class="built_in">Math</span>.round(evt.loaded * <span class="number">100</span> / evt.total);</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'progressNumber'</span>).innerHTML = percentComplete.toString() + <span class="string">'%'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'progressNumber'</span>).innerHTML = <span class="string">'unable to compute'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">uploadComplete</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        <span class="comment">/* 服务器端返回响应时候触发event事件*/</span></div><div class="line">        alert(evt.target.responseText);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">uploadFailed</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        alert(<span class="string">"There was an error attempting to upload the file."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">uploadCanceled</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        alert(<span class="string">"The upload has been canceled by the user or the browser dropped the connection."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> droptarget = <span class="built_in">document</span>.getElementById(<span class="string">"droptarget"</span>);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleEvent</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> info=<span class="string">""</span>,</div><div class="line">            output = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>),</div><div class="line">            files,i,len;</div><div class="line">        event.preventDefault();</div><div class="line">        <span class="keyword">if</span>(event.type == <span class="string">"drop"</span>)&#123;</div><div class="line">            files=event.dataTransfer.files;</div><div class="line">            i=<span class="number">0</span>;</div><div class="line">            len=files.length;</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(i&lt;len)&#123;</div><div class="line">                info += files[i].name + <span class="string">"("</span> + files[i].type + <span class="string">","</span> + files[i].size + <span class="string">" bytes)&lt;br&gt;"</span>;</div><div class="line">                i++;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">console</span>.log(info);</div><div class="line">            output.innerHTML=info;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    droptarget.addEventListener(<span class="string">"dragenter"</span>,handleEvent,<span class="literal">false</span>);</div><div class="line">    droptarget.addEventListener(<span class="string">"dragover"</span>,handleEvent,<span class="literal">false</span>);</div><div class="line">    droptarget.addEventListener(<span class="string">"drop"</span>,handleEvent,<span class="literal">false</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="JQuery-File-Upload"><a href="#JQuery-File-Upload" class="headerlink" title="JQuery File Upload"></a>JQuery File Upload</h2><p>jQuery File Upload 是一个Jquery文件上传组件，支持多文件上传、取消、删除，上传前缩略图预览、列表显示图片大小，支持上传进度条显示；支持各种动态语言开发的服务器端。<a href="https://github.com/blueimp/jQuery-File-Upload/wiki" target="_blank" rel="external">官网链接</a></p>
<p>特点：拖放支持；上传进度条；图像预览；可定制和可扩展的；兼容任何服务器端应用平台（PHP, Python, Ruby on Rails, Java, Node.js, Go etc.）。</p>
<h3 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h3><ol>
<li>需要加载的js文件：</li>
</ol>
<p>jquey-1.8.3.min.js</p>
<p>jquery-ui-widget.js</p>
<p>jquery.iframe-transport.js</p>
<p>jquery.fileupload.js</p>
<ol>
<li>html代码：</li>
</ol>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input <span class="built_in">id</span>=<span class="string">"fileupload"</span> type=<span class="string">"file"</span> <span class="built_in">name</span>=<span class="string">"files[]"</span> data-url=<span class="string">"server/php/"</span> multiple&gt;</div></pre></td></tr></table></figure>
<ol>
<li>js代码：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    $(<span class="string">'#fileupload'</span>).fileupload(&#123;</div><div class="line"></div><div class="line">        <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line"></div><div class="line">        <span class="attr">done</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e, data</span>) </span>&#123;</div><div class="line"></div><div class="line">            $.each(data.result.files, <span class="function"><span class="keyword">function</span> (<span class="params">index, file</span>) </span>&#123;</div><div class="line"></div><div class="line">                $(<span class="string">'&lt;p/&gt;'</span>).text(file.name).appendTo(<span class="built_in">document</span>.body);</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>3.1 显示上传进度条：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">　　$(<span class="string">'#fileupload'</span>).fileupload(&#123;</div><div class="line"></div><div class="line">    　　<span class="attr">progressall</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e, data</span>) </span>&#123;</div><div class="line"></div><div class="line">        　　<span class="keyword">var</span> progress = <span class="built_in">parseInt</span>(data.loaded / data.total * <span class="number">100</span>, <span class="number">10</span>);</div><div class="line"></div><div class="line">        　　$(<span class="string">'#progress .bar'</span>).css(</div><div class="line"></div><div class="line">            　　<span class="string">'width'</span>,</div><div class="line"></div><div class="line">            　　progress + <span class="string">'%'</span></div><div class="line"></div><div class="line">        　　);</div><div class="line"></div><div class="line">    　　&#125;</div><div class="line"></div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>3.2 取消上传<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> jqXHR = $(<span class="string">'#fileupload'</span>).fileupload(<span class="string">'send'</span>, &#123;<span class="attr">files</span>: filesList&#125;)</div><div class="line">    .error(<span class="function"><span class="keyword">function</span> (<span class="params">jqXHR, textStatus, errorThrown</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (errorThrown === <span class="string">'abort'</span>) &#123;</div><div class="line">            alert(<span class="string">'File Upload has been canceled'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">$(<span class="string">'button.cancel'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    jqXHR.abort();</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<ol>
<li>API</li>
</ol>
<p>4.1 Initialization：</p>
<p>在上传按钮上调用fileupload()方法;</p>
<p>示例：$(‘#fileupload’).fileupload();</p>
<p>4.2 Options :</p>
<p>1: url：请求发送的目标url</p>
<p>Type: string</p>
<p>Example: ‘/path/to/upload/handler.json’</p>
<p>2.Type: 文件上传HTTP请求方式，可以选择“POST”，“PUT”或者”PATCH”,</p>
<p>默认”POST”</p>
<p>Type: string</p>
<p>Example: ‘PUT’</p>
<ol>
<li>dataType:希望从服务器返回的数据类型，默认”json”</li>
</ol>
<p>Type: string</p>
<p>Example: ‘json’</p>
<ol>
<li>autoUpload:默认情况下，只要用户点击了开始按钮被添加至组件的文件会立即上传。将autoUpload值设为true可以自动上传。</li>
</ol>
<p>Type: boolean</p>
<p>Default: true</p>
<ol>
<li>acceptFileTypes：允许上传的的文件类型</li>
</ol>
<p>Example: /(.|\/)(gif|jpe?g|png|xlsx)$/i</p>
<ol>
<li>maxFileSize: 最大上传文件大小</li>
</ol>
<p>Example: 999000 (999KB)      //单位：B</p>
<ol>
<li>minFileSize:最小上传文件大小</li>
</ol>
<p>Example: 100000  (100KB)     //单位：B</p>
<p>8.previewMaxWidth : 图片预览区域最大宽度</p>
<p>Example: 100      //单位：px</p>
<p>4.3 Callback Options:</p>
<p>使用方法一：函数属性</p>
<pre><code>实例：$(&apos;#fileupload&apos;).fileupload({

　　drop: function (e, data) {

  　　$.each(data.files, function (index, file) {

      　　alert(&apos;Dropped file: &apos; + file.name);

  　　});

　　},

　　change: function (e, data) {

  　　$.each(data.files, function (index, file) {

      　　alert(&apos;Selected file: &apos; + file.name);

  　　});

　　}
</code></pre><p>　　});</p>
<p>使用方法二：绑定事件监听函数</p>
<p>　　实例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#fileupload'</span>)</div><div class="line"></div><div class="line">　　　　.bind(<span class="string">'fileuploaddrop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e, data</span>) </span>&#123;<span class="comment">/* ... */</span>&#125;)</div><div class="line"></div><div class="line">　　　　.bind(<span class="string">'fileuploadchange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e, data</span>) </span>&#123;<span class="comment">/* ... */</span>&#125;);</div></pre></td></tr></table></figure></p>
<p>每个事件名称都添加前缀：”fileupload”;</p>
<p>注意推荐使用第二种方法。</p>
<p>常用的回调函数：</p>
<ol>
<li>add: 当文件被添加到上传组件时被触发</li>
</ol>
<p>$(‘#fileupload’).bind(‘fileuploadadd’, function (e, data) {/<em> … </em>/});</p>
<p>或者$(‘#fileupload’).on(‘fileuploadadd’, function (e, data) {/<em> … </em>/});</p>
<ol>
<li><p>processalways: 当一个单独的文件处理队列结束（完成或失败时）触发</p>
</li>
<li><p>progressall: 全局上传处理事件的回调函数</p>
</li>
</ol>
<p>Example:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#fileupload'</span>).on(<span class="string">'fileuploadprogressall'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e, data</span>) </span>&#123;      <span class="comment">//进度条显示</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> progress = <span class="built_in">parseInt</span>(data.loaded / data.total * <span class="number">100</span>, <span class="number">10</span>);</div><div class="line"></div><div class="line">    $(<span class="string">'#progress .progress-bar'</span>).css(</div><div class="line"></div><div class="line">            <span class="string">'width'</span>,</div><div class="line"></div><div class="line">            progress + <span class="string">'%'</span></div><div class="line"></div><div class="line">    );</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<ol>
<li><p>fail : 上传请求失败时触发的回调函数，如果服务器返回一个带有error属性的json响应这个函数将不会被触发。</p>
</li>
<li><p>done : 上传请求成功时触发的回调函数，如果服务器返回一个带有error属性的json响应这个函数也会被触发。</p>
</li>
<li><p>always : 上传请求结束时（成功，错误或者中止）都会被触发。</p>
</li>
</ol>
<p>5.1跨域上传：</p>
<p>5.1.XMLHttpRequest跨域文件上传<br>不需要客户端做太多工作，需要浏览器支持XHR file upload.为了允许XHR跨域文件上传，服务端需要设置头部 Access-Control-Allow-Origin，如<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Access-Control-Allow-<span class="string">Origin:</span> <span class="string">http:</span><span class="comment">//example.org</span></div></pre></td></tr></table></figure></p>
<p>2.iframe传输跨域上传<br>需要设置forceIframeTransport option为true;<br>$(‘#fileupload’).fileupload({<br>    forceIframeTransport: true<br>});<br>iframe传输得不到服务端response headers，所以就没有iframe的response body，因此，iframe跨域上传需要直接返回到服务端来得到结果，因此需要设置redirect option给服务端绝对的URL地址<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$(</span><span class="string">'#fileupload'</span>).fileupload(</div><div class="line">    <span class="string">'option'</span>,</div><div class="line">    <span class="string">'redirect'</span>,</div><div class="line">    <span class="string">'http://example.org/result.html?%s'</span></div><div class="line">);</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/05/13/基于文件上传进度条实现/" data-id="cjdk0qrmq000gq8o0pb5nelef" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hihocoder-1094题解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/29/hihocoder-1094题解/" class="article-date">
  <time datetime="2017-04-29T02:15:46.000Z" itemprop="datePublished">2017-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/29/hihocoder-1094题解/">hihocoder-1094题解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Little Hi gets lost in the city. He does not know where he is. He does not know which direction is north.</p>
<p>Fortunately, Little Hi has a map of the city. The map can be considered as a grid of N*M blocks. Each block is numbered by a pair of integers. The block at the north-west corner is (1, 1) and the one at the south-east corner is (N, M). Each block is represented by a character, describing the construction on that block: ‘.’ for empty area, ‘P’ for parks, ‘H’ for houses, ‘S’ for streets, ‘M’ for malls, ‘G’ for government buildings, ‘T’ for trees and etc.</p>
<p>Given the blocks of 3<em>3 area that surrounding Little Hi(Little Hi is at the middle block of the 3</em>3 area), please find out the position of him. Note that Little Hi is disoriented, the upper side of the surrounding area may be actually north side, south side, east side or west side.</p>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>Line 1: two integers, N and M(3 &lt;= N, M &lt;= 200).<br>Line 2~N+1: each line contains M characters, describing the city’s map. The characters can only be ‘A’-‘Z’ or ‘.’.<br>Line N+2~N+4: each line 3 characters, describing the area surrounding Little Hi.</p>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>Line 1~K: each line contains 2 integers X and Y, indicating that block (X, Y) may be Little Hi’s position. If there are multiple possible blocks, output them from north to south, west to east.</p>
<h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="number">8</span> <span class="number">8</span></div><div class="line">..<span class="selector-class">.HSH</span>..</div><div class="line">..<span class="selector-class">.HSM</span>..</div><div class="line">..<span class="selector-class">.HST</span>..</div><div class="line">..<span class="selector-class">.HSPP</span>.</div><div class="line">PPGHSPPT</div><div class="line">PPSSSSSS</div><div class="line">.<span class="selector-class">.MMSHHH</span></div><div class="line">.<span class="selector-class">.MMSH</span>..</div><div class="line">SSS</div><div class="line">SHG</div><div class="line">SH.</div></pre></td></tr></table></figure>
<h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">5 </span><span class="number">4</span></div></pre></td></tr></table></figure>
<p>由于小Hi不能确认方向，故有4种方向为北的可能性，<br>$$<br> \begin{bmatrix}<br>   1 &amp; 2 &amp; 3 \<br>   4 &amp; 5 &amp; 6 \<br>   7 &amp; 8 &amp; 9<br>  \end{bmatrix} \tag{1}<br>$$<br>$$<br> \begin{bmatrix}<br>   3 &amp; 6 &amp; 9 \<br>   2 &amp; 5 &amp; 8 \<br>   1 &amp; 4 &amp; 7<br>  \end{bmatrix} \tag{2}<br>$$<br>$$<br> \begin{bmatrix}<br>   7 &amp; 4 &amp; 1 \<br>   8 &amp; 5 &amp; 2 \<br>   9 &amp; 6 &amp; 3<br>  \end{bmatrix} \tag{3}<br>$$<br>$$<br> \begin{bmatrix}<br>   9 &amp; 8 &amp; 7 \<br>   6 &amp; 5 &amp; 4 \<br>   3 &amp; 2 &amp; 1<br>  \end{bmatrix} \tag{4}<br>$$<br>然后找到地图上和a[5][5]相同的字符，再逐一判断4个矩阵a,b,c,d和四周是否相等即可<br>以下为AC代码：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;cmath&gt;</div><div class="line">#include &lt;<span class="type">string</span>&gt;</div><div class="line">using namespace std;</div><div class="line">int main()&#123;</div><div class="line">	int n, m,i,j,flag,t,k;</div><div class="line">	char ch[<span class="number">202</span>][<span class="number">202</span>];</div><div class="line">	char a[<span class="number">4</span>][<span class="number">4</span>], b[<span class="number">4</span>][<span class="number">4</span>], c[<span class="number">4</span>][<span class="number">4</span>], d[<span class="number">4</span>][<span class="number">4</span>];</div><div class="line">	for (i = <span class="number">0</span>; i &lt; <span class="number">202</span>; i++)&#123;</div><div class="line">		for (j = <span class="number">0</span>; j &lt; <span class="number">202</span>; j++)&#123;</div><div class="line">			ch[i][j] = '#';</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	cin &gt;&gt; n &gt;&gt; m;</div><div class="line">	for (i = <span class="number">1</span>; i &lt;= n; i++)&#123;</div><div class="line">		for (j = <span class="number">1</span>; j &lt;= m; j++)&#123;</div><div class="line">			cin &gt;&gt; ch[i][j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	for (i = <span class="number">1</span>; i &lt; <span class="number">4</span>; i++)&#123;</div><div class="line">		for (j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++)&#123;</div><div class="line">			cin &gt;&gt; a[i][j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	d[<span class="number">3</span>][<span class="number">3</span>] = c[<span class="number">1</span>][<span class="number">3</span>] = b[<span class="number">3</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">1</span>];<span class="comment">//1</span></div><div class="line">	d[<span class="number">3</span>][<span class="number">2</span>] = c[<span class="number">2</span>][<span class="number">3</span>] = b[<span class="number">2</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">2</span>];<span class="comment">//2</span></div><div class="line">	d[<span class="number">3</span>][<span class="number">1</span>] = c[<span class="number">3</span>][<span class="number">3</span>] = b[<span class="number">1</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">3</span>];<span class="comment">//3</span></div><div class="line">	d[<span class="number">2</span>][<span class="number">3</span>] = c[<span class="number">1</span>][<span class="number">2</span>] = b[<span class="number">3</span>][<span class="number">2</span>] = a[<span class="number">2</span>][<span class="number">1</span>];<span class="comment">//4</span></div><div class="line">	d[<span class="number">2</span>][<span class="number">2</span>] = c[<span class="number">2</span>][<span class="number">2</span>] = b[<span class="number">2</span>][<span class="number">2</span>] = a[<span class="number">2</span>][<span class="number">2</span>];<span class="comment">//5</span></div><div class="line">	d[<span class="number">2</span>][<span class="number">1</span>] = c[<span class="number">3</span>][<span class="number">2</span>] = b[<span class="number">1</span>][<span class="number">2</span>] = a[<span class="number">2</span>][<span class="number">3</span>];<span class="comment">//6</span></div><div class="line">	d[<span class="number">1</span>][<span class="number">3</span>] = c[<span class="number">1</span>][<span class="number">1</span>] = b[<span class="number">3</span>][<span class="number">3</span>] = a[<span class="number">3</span>][<span class="number">1</span>];<span class="comment">//7</span></div><div class="line">	d[<span class="number">1</span>][<span class="number">2</span>] = c[<span class="number">2</span>][<span class="number">1</span>] = b[<span class="number">2</span>][<span class="number">3</span>] = a[<span class="number">3</span>][<span class="number">2</span>];<span class="comment">//8</span></div><div class="line">	d[<span class="number">1</span>][<span class="number">1</span>] = c[<span class="number">3</span>][<span class="number">1</span>] = b[<span class="number">1</span>][<span class="number">3</span>] = a[<span class="number">3</span>][<span class="number">3</span>];<span class="comment">//9</span></div><div class="line">	for (i = <span class="number">1</span>; i &lt;= n; i++)&#123;</div><div class="line">		for (j = <span class="number">1</span>; j &lt;= m; j++)&#123;</div><div class="line">			if (a[<span class="number">2</span>][<span class="number">2</span>] == ch[i][j])&#123;</div><div class="line">				flag = <span class="number">1</span>;</div><div class="line">				for (t = <span class="number">1</span>; t &lt; <span class="number">4</span>; t++)&#123;</div><div class="line">					for (k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++)&#123;</div><div class="line">						if (a[t][k] != ch[i + t - <span class="number">2</span>][j + k - <span class="number">2</span>])&#123;</div><div class="line">							flag = <span class="number">0</span>; break;</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				if (flag == <span class="number">1</span>)cout &lt;&lt; i &lt;&lt; <span class="string">" "</span> &lt;&lt; j &lt;&lt; endl;</div><div class="line">				else&#123;</div><div class="line">					flag = <span class="number">1</span>;</div><div class="line">					for (t = <span class="number">1</span>; t &lt; <span class="number">4</span>; t++)&#123;</div><div class="line">						for (k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++)&#123;</div><div class="line">							if (b[t][k] != ch[i + t - <span class="number">2</span>][j + k - <span class="number">2</span>])&#123;</div><div class="line">								flag = <span class="number">0</span>; break;</div><div class="line">							&#125;</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">					if (flag == <span class="number">1</span>)cout &lt;&lt; i &lt;&lt; <span class="string">" "</span> &lt;&lt; j &lt;&lt; endl;</div><div class="line">					else&#123;</div><div class="line">						flag = <span class="number">1</span>;</div><div class="line">						for (t = <span class="number">1</span>; t &lt; <span class="number">4</span>; t++)&#123;</div><div class="line">							for (k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++)&#123;</div><div class="line">								if (c[t][k] != ch[i + t - <span class="number">2</span>][j + k - <span class="number">2</span>])&#123;</div><div class="line">									flag = <span class="number">0</span>; break;</div><div class="line">								&#125;</div><div class="line">							&#125;</div><div class="line">						&#125;</div><div class="line">						if (flag == <span class="number">1</span>)cout &lt;&lt; i &lt;&lt; <span class="string">" "</span> &lt;&lt; j &lt;&lt; endl;</div><div class="line">						else&#123;</div><div class="line">							flag = <span class="number">1</span>;</div><div class="line">							for (t = <span class="number">1</span>; t &lt; <span class="number">4</span>; t++)&#123;</div><div class="line">								for (k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++)&#123;</div><div class="line">									if (d[t][k] != ch[i + t - <span class="number">2</span>][j + k - <span class="number">2</span>])&#123;</div><div class="line">										flag = <span class="number">0</span>; break;</div><div class="line">									&#125;</div><div class="line">								&#125;</div><div class="line">							&#125;</div><div class="line">							if (flag == <span class="number">1</span>)cout &lt;&lt; i &lt;&lt; <span class="string">" "</span> &lt;&lt; j &lt;&lt; endl;</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/04/29/hihocoder-1094题解/" data-id="cjdk0qrnk000tq8o0sfe5y0md" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hihocode-1051题解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/28/hihocode-1051题解/" class="article-date">
  <time datetime="2017-04-28T02:04:31.000Z" itemprop="datePublished">2017-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/28/hihocode-1051题解/">hihocode-1051题解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>小Ho给自己定了一个宏伟的目标：连续100天每天坚持在hihoCoder上提交一个程序。100天过去了，小Ho查看自己的提交记录发现有N天因为贪玩忘记提交了。于是小Ho软磨硬泡、强忍着小Hi鄙视的眼神从小Hi那里要来M张”补提交卡”。每张”补提交卡”都可以补回一天的提交，将原本没有提交程序的一天变成有提交程序的一天。小Ho想知道通过利用这M张补提交卡，可以使自己的”最长连续提交天数”最多变成多少天。</p>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>第一行是一个整数T(1 &lt;= T &lt;= 10)，代表测试数据的组数。</p>
<p>每个测试数据第一行是2个整数N和M(0 &lt;= N, M &lt;= 100)。第二行包含N个整数a1, a2, … aN(1 &lt;= a1 &lt; a2 &lt; … &lt; aN &lt;= 100)，表示第a1, a2, …  aN天小Ho没有提交程序。</p>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每组数据，输出通过使用补提交卡小Ho的最长连续提交天数最多变成多少。</p>
<h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">3 </span> </div><div class="line"><span class="symbol">5 </span><span class="number">1</span>  </div><div class="line"><span class="symbol">34 </span><span class="number">77</span> <span class="number">82</span> <span class="number">83</span> <span class="number">84</span>  </div><div class="line"><span class="symbol">5 </span><span class="number">2</span>  </div><div class="line"><span class="symbol">10 </span><span class="number">30</span> <span class="number">55</span> <span class="number">56</span> <span class="number">90</span>  </div><div class="line"><span class="symbol">5 </span><span class="number">10</span>  </div><div class="line"><span class="symbol">10 </span><span class="number">30</span> <span class="number">55</span> <span class="number">56</span> <span class="number">90</span></div></pre></td></tr></table></figure>
<h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">76 </span> </div><div class="line"><span class="number">59</span></div><div class="line"><span class="number">100</span></div></pre></td></tr></table></figure>
<p>水题一道，直接枚举a[i+m+1]-a[i]-1的大小即可，并设置a[0]=0;</p>
<p>AC代码：</p>
<p>#include <iostream></iostream></p>
<p>#include <cmath><br>using namespace std;<br>int main(){<br>    int T,n,m,maxday,day;<br>    int a[101];<br>    cin &gt;&gt; T;<br>    while (T–){<br>        //数据初始化<br>        maxday = 0;<br>        for (int i = 0; i &lt; 101; i++){<br>            a[i] = 0;<br>        }<br>        cin &gt;&gt; n &gt;&gt; m;<br>        for (int i = 1; i &lt;= n; i++){<br>            cin &gt;&gt; a[i];<br>        }<br>        if (m &gt;= n){<br>            cout &lt;&lt; “100” &lt;&lt; endl;<br>        }<br>        else{<br>            for (int i = 0; i &lt; n-m; i++){<br>                day = a[i + m + 1] - a[i] - 1;<br>                if (day&gt;maxday){<br>                    maxday = day;<br>                }<br>            }<br>            cout &lt;&lt; maxday &lt;&lt; endl;<br>        }<br>    }<br>}</cmath></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/04/28/hihocode-1051题解/" data-id="cjdk0qrni000sq8o0ucmss79z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hihocoder-1039题解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/23/hihocoder-1039题解/" class="article-date">
  <time datetime="2017-04-23T13:51:25.000Z" itemprop="datePublished">2017-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/23/hihocoder-1039题解/">hihocoder-1039题解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>小Hi最近在玩一个字符消除游戏。给定一个只包含大写字母”ABC”的字符串s，消除过程是如下进行的：</p>
<p>1)如果s包含长度超过1的由相同字母组成的子串，那么这些子串会被同时消除，余下的子串拼成新的字符串。例如”ABCCBCCCAA”中”CC”,”CCC”和”AA”会被同时消除，余下”AB”和”B”拼成新的字符串”ABB”。</p>
<p>2)上述消除会反复一轮一轮进行，直到新的字符串不包含相邻的相同字符为止。例如”ABCCBCCCAA”经过一轮消除得到”ABB”，再经过一轮消除得到”A”</p>
<p>游戏中的每一关小Hi都会面对一个字符串s。在消除开始前小Hi有机会在s中任意位置(第一个字符之前、最后一个字符之后以及相邻两个字符之间)插入任意一个字符(‘A’,’B’或者’C’)，得到字符串t。t经过一系列消除后，小Hi的得分是消除掉的字符的总数。</p>
<p>请帮助小Hi计算要如何插入字符，才能获得最高得分。</p>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>输入第一行是一个整数T(1&lt;=T&lt;=100)，代表测试数据的数量。</p>
<p>之后T行每行一个由’A’’B’’C’组成的字符串s，长度不超过100。</p>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每一行输入的字符串，输出小Hi最高能得到的分数。</p>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>第一组数据：在”ABCBCCCAA”的第2个字符后插入’C’得到”ABCCBCCCAA”，消除后得到”A”，总共消除9个字符(包括插入的’C’)。</p>
<p>第二组数据：”AAA”插入’A’得到”AAAA”，消除后得到””，总共消除4个字符。</p>
<p>第三组数据：无论是插入字符后得到”AABC”,”ABBC”还是”ABCC”都最多消除2个字符。</p>
<h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="number">3</span></div><div class="line">ABCBCCCAA</div><div class="line">AAA</div><div class="line">ABC</div></pre></td></tr></table></figure>
<h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">9</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<p>刚开始的想法是将得到的字符串先消除相同的的字母，得到一个相邻位置没有字母的字符串，然后再通过每一个字母来中心扩展找到最大对称字符串长度，则分数就为得到的字符串长度-消除相邻字母后的长度+最大对称字符串长度+1（加入的字符必可消除）eg:(BBCCBACABA)-&gt;(BACABA)-&gt;(BACCABA)-&gt;(A)<br>但是发现WA，举反例后发现BBBAB插入为BABBAB消除后字符串为空，但我的算法消除为剩一个A或B，故还是只能用暴力解法，在每个位置加入字母’A’,’B’,’C’</p>
<p>以下为AC的代码<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">make</span><span class="params">(<span class="built_in">string</span> s, <span class="keyword">int</span> i, <span class="built_in">string</span> c)</span></span>&#123;</div><div class="line">	s.insert(i, c);</div><div class="line">	<span class="keyword">int</span> n1,n;</div><div class="line">	n = s.length();</div><div class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)&#123;</div><div class="line">		n1 = s.length();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length() - <span class="number">1</span>&amp;&amp;s.length()!=<span class="number">0</span>; i++)&#123;</div><div class="line">			<span class="keyword">if</span> (s[i + <span class="number">1</span>] == s[i])&#123;</div><div class="line">				<span class="keyword">while</span> (i + <span class="number">1</span> &lt; s.length() &amp;&amp; s[i + <span class="number">1</span>] == s[i])s.erase(i + <span class="number">1</span>, <span class="number">1</span>);</div><div class="line">				s.erase(i, <span class="number">1</span>);</div><div class="line">				i--;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (n1 == s.length())<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> n - n1;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">string</span> s;</div><div class="line">	<span class="keyword">int</span> i, j, count,T;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; T;</div><div class="line">	<span class="keyword">while</span> (T--)&#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; s;</div><div class="line">		count = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= s.length(); i++)&#123;</div><div class="line">			count = max(make(s, i, <span class="string">"A"</span>), count);</div><div class="line">			count = max(make(s, i, <span class="string">"B"</span>), count);</div><div class="line">			count = max(make(s, i, <span class="string">"C"</span>), count);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; count &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/04/23/hihocoder-1039题解/" data-id="cjdk0qrmh000cq8o0x7wmiuor" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端资源的积累" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/20/前端资源的积累/" class="article-date">
  <time datetime="2017-04-20T11:57:01.000Z" itemprop="datePublished">2017-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/前端资源的积累/">前端资源的积累</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h2><p><a href="http://www.alloyteam.com/page/0/" target="_blank" rel="external">alloyteam</a><br><a href="http://www.ruanyifeng.com/blog/2016/09/react-technology-stack.html" target="_blank" rel="external">阮一峰React技术栈</a><br><a href="http://es6.ruanyifeng.com/" target="_blank" rel="external">ES6 gitbook</a><br><a href="https://75team.com/" target="_blank" rel="external">奇舞团</a><br><a href="http://www.zhangxinxu.com/" target="_blank" rel="external">张鑫旭</a></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p><a href="http://alloyteam.github.io/gopng/" target="_blank" rel="external">css sprites合成工具goPNG</a><br><a href="http://www.pjhome.net/web/html5/encodeDataUrl.htm" target="_blank" rel="external">base-64编码工具</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://VampireKnigh.github.io/2017/04/20/前端资源的积累/" data-id="cjdk0qrmn000eq8o07stq82cg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA-代码编写规范/">JAVA 代码编写规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java基础/">Java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css积累/">css积累</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-前端/">react 前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端构建工具/">前端构建工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/JAVA-代码编写规范/" style="font-size: 10px;">JAVA 代码编写规范</a> <a href="/tags/Java基础/" style="font-size: 10px;">Java基础</a> <a href="/tags/css积累/" style="font-size: 15px;">css积累</a> <a href="/tags/react-前端/" style="font-size: 10px;">react 前端</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/前端构建工具/" style="font-size: 10px;">前端构建工具</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/算法/" style="font-size: 20px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/02/12/代码编写规范-排版/">代码编写规范</a>
          </li>
        
          <li>
            <a href="/2018/02/12/Java基础（一）/">Java基础（一）</a>
          </li>
        
          <li>
            <a href="/2017/06/15/图片优化/">图片优化</a>
          </li>
        
          <li>
            <a href="/2017/05/25/gulp和webpack的区别/">gulp和webpack的区别</a>
          </li>
        
          <li>
            <a href="/2017/05/21/react-DOM-diff算法/">react DOM diff算法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 yd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>